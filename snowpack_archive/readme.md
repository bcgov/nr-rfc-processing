# Archive Files to Object Store

The snowpack analysis generates a lot of data. Each daily analysis accounts for
approximately 2-4 gigs of storage.  Current storage analysis would not allow
for all of the data associated with a freshet season to be stored on the
existing allocation of SAN space for the River Forecast Centre.  Further to
this the likelyhood of requiring older data is significantly lower than more
recent data.

To resolve the storage issue, and still be able to retain the data that is
generated by the various snowpack analyses, the data older than 2 weeks will be
moved to object storage.  This directory contains the code that is used to
complete the archive process.

# What it Does

* The script walks the directory structure contained in the environment variable SRC_ROOT_DIR
* Finds directories matching pattern YYYY.MM.DD
* Evaluates the date of the directory name for whether it is older than 15 days
* if older then backs up to object storage into the directory defined in the env var OBJ_STORE_ROOT_DIR

# Environment Variables Required

* SRC_ROOT_DIR(optional) - The source root directory that will be traversed for backup
* OBJ_STORE_BUCKET - name of the object store bucket
* OBJ_STORE_SECRET - name of the object store secret
* OBJ_STORE_HOST - host name of the object store service
* OBJ_STORE_USER - name of the object store user associated with the secret
* OBJ_STORE_ROOT_DIR(optional) - directory path in the object store to backup to

# Perform Backup

## install dependencies
The backup process requires a small subset of the requirements of the actual
snowpack analysis, so have kept the dependencies required by this script in
the `snowpack_archive\requirements.txt` file.

Recommend installing dependencies into a virtual env as it much lighter weight
than a conda install.

```
python -m virtualenv <name of ve>
<name of ve>/Scripts/activate.bat
pip install -r snowpack_archive/requirements.txt
```

## Run Script
Having set the environment variables describes above, and installed the dependencies

```
python snowpack_archive\runS3Backup.py
```